<html>
<head>
	<title>myComix - </title>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="shortcut icon" href="data:data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAXdaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MiA3OS4xNjA5MjQsIDIwMTcvMDcvMTMtMDE6MDY6MzkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA4LTE5VDAxOjEwOjAzKzA5OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wOS0wNVQxOTowNDozNCswOTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMC0wOS0wNVQxOTowNDozNCswOTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDphNDQ2OTM5YS00NGZkLTViNDEtOWQ3NC05MDg3N2E5OGY3ZjIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N2UzNDdjMzAtYjRhZS02NjRlLTkyMDQtNzA4M2Y3NWFlZGY1IiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6N2UzNDdjMzAtYjRhZS02NjRlLTkyMDQtNzA4M2Y3NWFlZGY1Ij4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo3ZTM0N2MzMC1iNGFlLTY2NGUtOTIwNC03MDgzZjc1YWVkZjUiIHN0RXZ0OndoZW49IjIwMjAtMDgtMTlUMDE6MTA6MDMrMDk6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmE0NDY5MzlhLTQ0ZmQtNWI0MS05ZDc0LTkwODc3YTk4ZjdmMiIgc3RFdnQ6d2hlbj0iMjAyMC0wOS0wNVQxOTowNDozNCswOTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4Q/ejHAAAMaklEQVR4Xu3dX4xeRR3G8VlvegNFSNrsNlShDQQTEqWiTTQpNNQL0jZt9QI1EqnRRLwB1Kohoq01hNBo1ZhUU7UqBvVCaUNJjdasNNFYUrEkQgikFSPa0l4ohcuS9Tz7zuu+nM6cf3vOe857ft9Psul5t8subeeZM7+ZOfNOOefmkg/ApLf4XwGTCABMIwAwjQDAtGARPDdHXYx+mppSk1/AHQCmBe8Aq6aX+St7Tp05568WrJ5Z7q8w6U6fPe+vBrgDwDQCANMI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">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Gugi&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
	<style type="text/css">
		body {
			font-family: 'Nanum Gothic', sans-serif;
			font-size: smaller;
		}
		a:link {text-decoration: none;}
		a:visited {text-decoration: none;}
		a:active {text-decoration: none;}
		a:hover {text-decoration: none;}
	</style>
</head>
<body>
<div class="container-fluid" >

<?php
include("config.php");

if($_GET['dir']){
	$getdir = str_replace("{plus}", "+", urldecode($_GET['dir']));
	$dir = $base_dir.$getdir;
} else {
	$dir = $base_dir;
}
$iterator = new DirectoryIterator($dir);
$dircounter = 0;
$titlecounter = 0;
$filecounter = 0;

foreach ($iterator as $fileinfo) {
    if (!$fileinfo->isDot() && $fileinfo != "@eaDir" && $fileinfo->isDir()) {
		$sub_iterator = new DirectoryIterator($dir."/".$fileinfo->getFilename());
		$sub_dircounter = 0;
		$subdir_list = array();
		foreach ($sub_iterator as $subfileinfo) {
			if (!$subfileinfo->isDot() && $subfileinfo != "@eaDir" && $subfileinfo->isDir()) {
				$subdir_list[$sub_dircounter] = $subfileinfo->getFilename();
				$sub_dircounter++;
			}
		}
		if(count($subdir_list)>0){
			$dir_list[$dircounter] = $fileinfo->getFilename();
			$dircounter++;
		} else {
			$title_list[$titlecounter] = $fileinfo->getFilename();
			$titlecounter++;
		}
		unset($subdir_list);
    }
    if ($fileinfo->isFile()) {
		if(strpos($fileinfo, ".json")){
		} else {
			if(strpos($fileinfo, "zip") !== false || strpos($fileinfo, "cbz") !== false) {
				$file_list[$filecounter] = $fileinfo->getFilename();
				$filecounter++;
			}
		}
    }
}
sort($file_list, SORT_NATURAL);
sort($dir_list, SORT_NATURAL);
sort($title_list, SORT_NATURAL);

$maxlist = count($file_list) + count($title_list) + count($dir_list);
$startview = 0;
if(!$_GET['page']){
	$paging = 0; //현재 보여주는 페이지
}  else {
    $paging = (int)$_GET['page'];
}

$startview = $paging*$maxview;
$endview = $startview+$maxview;
if($endview >= $maxlist){
	$endview = $maxlist;
}
$updir = "";
?>
	<div>
	<br><br>
		<h1 style="font-family: 'Gugi'; " onclick="location.href='index.php'">마이코믹스</h1>
		<h6 style="font-family: 'Nanum Gothic', sans-serif;"><br>[<?php echo $getdir;?>]</h6>
	<br><br>
	</div>
<div class="grid">
<div class="row row-cols-1 row-cols-md-2">

	<?php
	if($dir == $base_dir) {
	} else {
	$nowdirarr = explode("/", $getdir);
	$temp = count($nowdirarr);
	for($i = 1;$i<$temp-1;$i++) {
		$updir = $updir."/".$nowdirarr[$i];
	}
	?>	

	<a href='index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $updir));?>'>
    <div class="card bg-primary m-1 p-0">
				<div class="card-body text-white m-1 p-1">
				<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-90deg-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z"/>
</svg> 상위폴더로
				</div>
				</div>
				</a>
	<?php
	}
	$dir_start = $startview;
	if(count($dir_list) > 0){
		for($i=$dir_start;$i<$endview;$i++) {
			$startview = $i;
			$fileinfo = $dir_list[$i];
			$dirs = str_replace($base_dir."/", "", $dir);
			if($i >= count($dir_list)){
				break;
			}

	?>	
			 
	<a href='index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $getdir."/".$fileinfo));?>'>
    <div class="card border-secondary m-1 p-0">
				<div class="card-body text-secondary m-1 p-1">
					<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-folder-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3zm-8.322.12C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139z"/>
</svg> <?php echo $fileinfo;?>
				</div>
			</div>
				</a>
	<?php
		}
	}

	$title_start = $startview;
	if(count($title_list) > 0){
		for($i=$title_start;$i<$endview;$i++) {
			$startview = $i;
			$fileinfo = $title_list[$i-count($dir_list)];
			$dirs = str_replace($base_dir."/", "", $dir);
			if($i >= count($title_list)+count($dir_list)){
				break;
			}
	?>	
	<a href='index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $getdir."/".$fileinfo)); ?>'>			 
    <div class="card text-white bg-secondary m-1 p-0">
				<div class="card-body m-1 p-1">
					<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-book" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M1 2.828v9.923c.918-.35 2.107-.692 3.287-.81 1.094-.111 2.278-.039 3.213.492V2.687c-.654-.689-1.782-.886-3.112-.752-1.234.124-2.503.523-3.388.893zm7.5-.141v9.746c.935-.53 2.12-.603 3.213-.493 1.18.12 2.37.461 3.287.811V2.828c-.885-.37-2.154-.769-3.388-.893-1.33-.134-2.458.063-3.112.752zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
</svg> <?php echo $fileinfo;?>
				</div>
			</div>
				</a>
	<?php
		}
	}

	?>	
	</div>
	</div>
	<br><br>
<div class="grid">
<div class="row row-cols-2 row-cols-md-4">
		<?php
		if(count($file_list) > 0 && $endview > $startview){
		for($i=$startview;$i<$endview;$i++) {
					$fileinfo = $file_list[$i-count($dir_list)-count($title_list)];
					$zip_file = $dir."/".$fileinfo;
					if(strpos($zip_file, ".zip")){
						$configfile = str_replace(".zip", "", $zip_file).".json";
					} elseif(strpos($zip_file, ".cbz")){
						$configfile = str_replace(".cbz", "", $zip_file).".json";
					}
			if(is_File($configfile) === false){
					$zip = new ZipArchive;
					if ($zip->open($zip_file) == TRUE) {
						$size = getimagesizefromstring($zip->getFromIndex(0));
						if($size[0] > $size[1]) {
							$x_point = ($size[0]/2) - $size[1];
							$originimage = imagecreatefromstring($zip->getFromIndex(0));
							if($x_point > 0){
								$cropimage = imagecrop($originimage, ['x' => $x_point, 'y' => 0, 'width' => $size[1], 'height' => $size[1]]);
							} else {
								$cropimage = imagecrop($originimage, ['x' => 0, 'y' => 0, 'width' => $size[1], 'height' => $size[1]]);
							}
							$originimage = $cropimage;
							$cropimage = imagecreatetruecolor(400, 400);
							imagecopyresampled($cropimage, $originimage, 0, 0, 0, 0, 400, 400, $size[1], $size[1]);
							imagedestroy($originimage);
							ob_start();
							imagejpeg($cropimage, null, 75 );
							imagedestroy($cropimage);
							$cropimage = ob_get_contents();
							ob_end_clean();

						} else {
							$originimage = imagecreatefromstring($zip->getFromIndex(0));
							$y_point = ($size[1] - $size[0])/2;
							$cropimage = imagecrop($originimage, ['x' => 0, 'y' => 0, 'width' => $size[0], 'height' => $size[0]]);
							$originimage = $cropimage;
							$cropimage = imagecreatetruecolor(400, 400);
							imagecopyresampled($cropimage, $originimage, 0, 0, 0, 0, 400, 400, $size[0], $size[0]);
							imagedestroy($originimage);
							ob_start();
							imagejpeg($cropimage, null, 75 );
							imagedestroy($cropimage);
							$cropimage = ob_get_contents();
							ob_end_clean();
						}
					}
					$cache_data = array();
					$cache_data['totalpage'] = $zip->numFiles;
					$cache_data['page_order'] = "0";
					$cache_data['thumbnail'] = base64_encode($cropimage);
					$zip->close();
					$cache_output = json_encode($cache_data, JSON_UNESCAPED_UNICODE);
					file_put_contents($configfile, $cache_output);
			}

			$json_data = json_decode(file_get_contents($configfile), true);
			$img_output = $json_data['thumbnail'];
			$totalpage = $json_data['totalpage'];
			$pageorder = $json_data['page_order'];
				if((int)$json_data['page_order'] == 0) {
					$pageorder = "[ - ]";
				} elseif((int)$json_data['page_order'] == 1) {
					$pageorder = "[1|2]";
				} elseif((int)$json_data['page_order'] == 2) {
					$pageorder = "[2|1]";
				}

			if(strpos($nowdirarr[count($nowdirarr)-1],"] ")){
				$dir_s = preg_replace("/\[[^]]*\]/","",$nowdirarr[count($nowdirarr)-1]);
				$t = str_replace($dir_s,"", $nowdirarr[count($nowdirarr)-1]);
				$dir_s = str_replace($t." ","", $nowdirarr[count($nowdirarr)-1]);
			} else {
				$dir_s = preg_replace("/\[[^]]*\]/","",$nowdirarr[count($nowdirarr)-1]);
			}
			$title_s = str_replace($dir_s, "", $fileinfo);
			$title_s = str_replace(".zip", "", $title_s);
			if(strpos($title_s, "|") !== false){
				$pos = explode("|", $title_s);
				$title_s= $pos[1];
			} elseif(strpos($title_s, "｜") !== false){
				$pos = explode("｜", $title_s);
				$title_s= $pos[1];
			} elseif(strpos($title_s, " l ") !== false){
				$pos = explode(" l ", $title_s);
				$title_s= $pos[1];
			} elseif(strpos($title_s, "│") !== false){
				$pos = explode("│", $title_s);
				$title_s= $pos[1];
			} else {
				$title_s = str_replace($_GET['title'], "", $title_s);
				$title_s = str_replace("(decensored)", "무수정", $title_s);
				$title_s = preg_replace("~\(.*\)~","",$title_s);
				$title_s = preg_replace("/\[[^]]*\]/","",$title_s);
			}
		?>
<a href='viewer.php?file=<?php echo urlencode(str_replace("+","{plus}", $getdir."/".$fileinfo));?>'>
  <div class="col mb-3">
    <div class="card text-black m-0 p-1">
		<img src="data:<?php echo mime_type("jpg").";base64,".$img_output; ?>" class="rounded card-img-top card-img" alt="thumbnail">
					<div class="card-img-overlay m-1 p-0">
					<span class="badge badge-pill badge-success"><?php echo $totalpage; ?>p</span>
					<span class="badge badge-pill badge-success"><?php echo $pageorder; ?></span>
					</div>
		<div class="card-body m-0 p-0 text-center text-nowrap" style="text-overflow: ellipsis; overflow: hidden;">
			<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-file-earmark-zip-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M2 2a2 2 0 0 1 2-2h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm7 2l.5-2.5 3 3L10 5a1 1 0 0 1-1-1zM5.5 3V2h-1V1H6v1h1v1H6v1h1v1H6v1h1v1H5.5V6h-1V5h1V4h-1V3h1zm0 4.5a1 1 0 0 0-1 1v.938l-.4 1.599a1 1 0 0 0 .416 1.074l.93.62a1 1 0 0 0 1.109 0l.93-.62a1 1 0 0 0 .415-1.074l-.4-1.599V8.5a1 1 0 0 0-1-1h-1zm0 1.938V8.5h1v.938a1 1 0 0 0 .03.243l.4 1.598-.93.62-.93-.62.4-1.598a1 1 0 0 0 .03-.243z"/>
</svg> <?php echo $title_s;?>
		</div>
    </div>
  </div>
</a>
		<?php
			}
		} else {
			$have_file = 0;
		}
		?>
	</div>
</div>
<br>
<p align=center><?php echo "인덱스버전 : ".$version['index']." 뷰어버전 : ".$version['viewer']; ?></p>

<nav aria-label="Page navigation">
  <ul class="pagination pagination-outline-primary justify-content-center">
    <li class="page-item <?php if($dir == $base_dir) { echo "disabled"; } ?>">
      <a class="page-link" onclick="location.href='index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $updir));?>'" href="#" tabindex="-1" aria-disabled="true">상위폴더로</a>
    </li>
    <li class="page-item <?php if($paging == 0) { echo "disabled"; } ?>">
	</li>
    <li class="page-item <?php if($paging == 0) { echo "disabled"; } ?>">
      <a class="page-link" onclick="location.href='./index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $getdir)); ?>&page=<?php echo (int)$_GET['page']-1; ?>'" href="#" tabindex="-1" aria-disabled="true">Previous</a>
    </li>
				<li class="nav-bar dropdown">
					<button class="page-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown">
					<?php echo (int)(int)$_GET['page']+1; ?>/<?php 
						echo ceil($maxlist/$maxview);					
					?>
					</button>

					<div class="dropdown-menu">
	
	
<?php	
					$pagingcount = 0;
				while($pagingcount<($maxlist/$maxview)){
			?>
					<a onclick="location.href='./index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $getdir)); ?>&page=<?php echo $pagingcount; ?>'" href="#" class="dropdown-item">[<?php echo $pagingcount+1; ?>페이지]</a>
			<?php
				$pagingcount++;
				}

	?>
					</div>
				</li>
	    <li class="page-item <?php if(($maxview*($paging+1))>=$maxlist) { echo "disabled"; } ?>">
      <a class="page-link" onclick="location.href='./index.php?dir=<?php echo urlencode(str_replace("+","{plus}", $getdir)); ?>&page=<?php echo (int)$_GET['page']+1; ?>'" href="#">Next</a>
    </li>
  </ul>
</nav>
<br><br>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
</body>
</html>
